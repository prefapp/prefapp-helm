{{- define "ph.curl.template_structure" -}}

name: {{ .name }}
annotations:
  helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded

{{ $args := (list) }}
{{ $args = append $args "-X" }}
{{ $args = append $args (default "GET" .curl_options.verb) }}
{{ range $header := .curl_options.headers }}
  {{ $args = append $args "-H" }}
  {{ $args = append $args $header }}
{{ end }}

{{ $args = append $args .curl_options.url }}


containers:
  - name: test
    image: curlimages/curl
    args: {{ $args | toYaml | nindent 6 }}

{{- end -}}


{{- define "ph.curl_test.template" -}}

{{ include "ph.test.render" ( include "ph.curl.template_structure" . | fromYaml )}}

{{- end -}}
